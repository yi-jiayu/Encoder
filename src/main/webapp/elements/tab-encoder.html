<dom-module id="tab-encoder">

    <template>
        <paper-material elevation="1" class="card">
            <div>
                <paper-textarea label="Plaintext" id="encoder-input" value="{{plaintext}}"></paper-textarea>
            </div>
        </paper-material>
        <paper-material elevation="1" class="card" style="padding-bottom: 64px;">
            <div>
                <paper-textarea label="Ciphertext" id="encoder-output" value="[[encode(plaintext)]]"></paper-textarea>
            </div>
            <div>
                <paper-button id="encoder-output-copy" raised="true" class="button" on-click="copyEncoderOutput">COPY</paper-button>
            </div>
        </paper-material>
    </template>

    <script>
        var encoderOutput = "";

        // element registration
        Polymer({
            is: "tab-encoder",

            // add properties and methods on the element's prototype
            properties: {
                // declare properties for the element's public API
                plaintext: String
            },

            encode: function(plaintext) {
                return encode(plaintext);
            },

            copyEncoderOutput: function() {
                // create a "hidden" input
                var aux = document.createElement("input");

                // assign it the value of the specified element
                aux.setAttribute("value", encoderOutput);

                // append it to the body
                document.body.appendChild(aux);

                // highlight its content
                aux.select();

                // copy the highlighted text
                document.execCommand("copy");

                // remove it from the body
                document.body.removeChild(aux);
            }
        });

        function encode(plaintext) {
            var plaintextKey = "abcdefghijklmnopqrstuvwxyz ";
            var ciphertextKey = "oespaporohpqenhsce@@ftolrkn mgot@@ogoattu acib@@ao@@";
            var ciphertext = "";

            if (plaintext) {
                plaintext = plaintext.toLowerCase();
                for (var i = 0, len = plaintext.length; i < len; i++) {
                    var hit = plaintextKey.search(plaintext[i]);
                    if (hit == -1) {
                        ciphertext += plaintext[i];
                    } else if (hit == 26) {
                        ciphertext += " ";
                    } else {
                        hit = hit * 2;
                        ciphertext += ciphertextKey.slice(hit, hit + 2).trim();
                    }
                }
                encoderOutput = ciphertext.trim();
                return encoderOutput;
            } else {
                return "";
            }
        }
    </script>
</dom-module>