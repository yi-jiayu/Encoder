<dom-module id="tab-decoder">

    <template>
        <paper-material elevation="1" class="card">
            <div>
                <paper-textarea label="Ciphertext" id="decoder-input" value="{{ciphertext}}"></paper-textarea>
            </div>
        </paper-material>
        <paper-material elevation="1" class="card" style="padding-bottom: 64px;">
            <div>
                <paper-textarea label="Plaintext" id="decoder-output" value="[[decode(ciphertext)]]"></paper-textarea>
            </div>
            <div>
                <paper-button id="decoder-output-copy" raised="true" class="button" on-click="copyDecoderOutput">COPY</paper-button>
            </div>
        </paper-material>
    </template>

    <script>
        var decoderOutput = "";
        // element registration
        Polymer({
            is: "tab-decoder",

            // add properties and methods on the element's prototype
            properties: {
                // declare properties for the element's public API
                ciphertext: String
            },

            decode: function (ciphertext) {
                return decode(ciphertext);
            },

            copyDecoderOutput: function() {
                // create a "hidden" input
                var aux = document.createElement("input");

                // assign it the value of the specified element
                aux.setAttribute("value", decoderOutput);

                // append it to the body
                document.body.appendChild(aux);

                // highlight its content
                aux.select();

                // copy the highlighted text
                document.execCommand("copy");

                // remove it from the body
                document.body.removeChild(aux);
            }
        });

        function decode(ciphertext) {
            var plaintextKey = "abcdefghijklmnopqrstuvwxyz ";
            var ciphertextKey = "oespaporohpqenhscejaftolrkn mgotqqogoattu acib@@aoak";
            var plaintext = "";

            if (ciphertext) {
                ciphertext = ciphertext.toLowerCase();
                for (var i = 0, len = ciphertext.length; i < len; i++) {
                    switch (ciphertext[i]) {
                        case " ":
                        case "n":
                        case "u":
                            plaintext += ciphertext[i];
                            break;
                        default:
                                var hit = ciphertextKey.search(ciphertext.slice(i, i+2));
                                if (hit % 2 === 0 && i != ciphertext.length-1) {
                                    plaintext += plaintextKey[hit/2];
                                    i++;
                                } else if (hit == -1 && plaintextKey.search(ciphertext[i]) == -1) {
                                    plaintext += ciphertext[i];
                                }
                    }
                }
                decoderOutput = plaintext.trim();
                return decoderOutput;
            } else {
                return "";
            }
        }
    </script>
</dom-module>